{
    "workflow_name": "Calculate building density",
    "task_statement": "计算每个地块的建筑密度（基底面积/地块面积）。",
    "arcgis_context": { "workspace": "project.gdb", "coordinate_system": "projected", "linear_unit": "meters", "area_unit": "square_meters" },
    "inputs": [
        { "layer_name": "parcel", "geometry_type": "polygon", "required_fields": ["parcel_id", "parcel_area"] },
        { "layer_name": "building", "geometry_type": "polygon", "required_fields": ["building_area"] }
    ],
    "steps": [
        {
            "step_id": "S1",
            "tool": "Spatial Join",
            "purpose": "统计每个地块内的建筑基底面积总和",
            "parameters": {
                "target_features": "parcel",
                "join_features": "building",
                "join_operation": "JOIN_ONE_TO_ONE",
                "match_option": "HAVE_THEIR_CENTER_IN",
                "summary_fields": [{"field": "building_area", "statistic": "SUM", "out_field": "sum_base_area"}]
            },
            "inputs": [{"source": "input", "layer_name": "parcel"}, {"source": "input", "layer_name": "building"}],
            "outputs": [{ "name": "parcel_base_sum", "type": "feature_class", "geometry_type": "polygon", "new_fields": ["sum_base_area"], "path_hint": "project.gdb/parcel_base_sum" }],
            "qc_checks": []
        },
        {
            "step_id": "S2",
            "tool": "Calculate Field",
            "purpose": "计算密度字段",
            "parameters": {
                "field": "building_density",
                "expression": "!sum_base_area! / !parcel_area!",
                "expression_type": "PYTHON3"
            },
            "inputs": [{"source": "step_output", "layer_name": "S1.parcel_base_sum"}],
            "outputs": [{ "name": "parcel_with_density", "type": "feature_class", "geometry_type": "polygon", "new_fields": ["building_density"], "path_hint": "project.gdb/parcel_with_density" }],
            "qc_checks": [{"check": "密度应在0-1之间", "how": "max(building_density)", "pass_condition": "<=1"}]
        }
    ],
    "outputs": [{ "name": "parcel_with_density", "type": "feature_class", "geometry_type": "polygon", "fields": ["parcel_id", "building_density"], "description": "带有建筑密度的地块" }],
    "assumptions": ["building_area 代表建筑基底面积"]
}